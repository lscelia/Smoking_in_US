---
title: "Smoking and Covid-19"
author: "Wanxin Qi"
date: "12/7/2021"
output: github_document
---

```{r setup, include = FALSE}
library(tidyverse)

knitr::opts_chunk$set(
  warning = FALSE,
  message = FALSE,
  fig.width = 8,
  fig.height = 6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

## Import and Clean Data From NHIS

```{r data_import}
adult_19 = 
  read_csv("data/adult19.csv") %>%
  select(SEX_A, AGEP_A, SMKCIGST_A, PHSTAT_A, EDUC_A, ORIENT_A, HISPALLP_A, HISDETP_A, DISAB3_A, BMICAT_A, CANEV_A, DIBEV_A, DIBTYPE_A, DEMENEV_A, CHDEV_A, PREGNOW_A, ASTILL_A, STREV_A, HYPEV_A, COPDEV_A, ANXEV_A, DEPEV_A) %>%
  mutate(YEAR = 2019,
         HLTHCOND_A = NA
         ) %>%
  relocate(YEAR)

adult_20 = 
  read_csv("data/adult20.csv") %>%
  select(SEX_A, AGEP_A, SMKCIGST_A, PHSTAT_A, EDUC_A, ORIENT_A, HISPALLP_A, HISDETP_A, DISAB3_A, BMICAT_A, CANEV_A, DIBEV_A, DIBTYPE_A, DEMENEV_A, CHDEV_A, PREGNOW_A, ASTILL_A, STREV_A, HYPEV_A, COPDEV_A, ANXEV_A, DEPEV_A, HLTHCOND_A) %>%
  mutate(YEAR = 2020) %>%
  relocate(YEAR)

adult = rbind(adult_19, adult_20)
```

```{r clean_and_tidy}
adult =
  adult %>%
  janitor::clean_names() %>%
  mutate(
    sex = case_when(
      sex_a == "1" ~ "male",
      sex_a == "2" ~ "female",
      sex_a == "7" ~ "refused",
      sex_a == "8" ~ "not ascertained",
      sex_a == "9" ~ "don't know"
    ),
    
    age = agep_a,
    
    smoke = case_when(
      smkcigst_a == "1" ~ "current every day smoker",
      smkcigst_a == "2" ~ "current some day smoker",
      smkcigst_a == "3" ~ "former smoker",
      smkcigst_a == "4" ~ "never smoker",
      smkcigst_a == "5" ~ "smoker, current status unknown",
      smkcigst_a == "9" ~ "unknown if ever smoked"
    ),

    education = case_when(
      educ_a == "0" ~ "never attended/kindergarten only",
      educ_a == "1" ~ "grade 1-11",
      educ_a == "2" ~ "12th grade, no diploma",
      educ_a == "3" ~ "GED or equivalent",
      educ_a == "4" ~ "high school graduate",
      educ_a == "5" ~ "some college, no degree",
      educ_a == "6" ~ "associate degree: occupational, technical, or vocational program",
      educ_a == "7" ~ "associate degree: academic",
      educ_a == "8" ~ "bachelor's degree",
      educ_a == "9" ~ "master's degree",
      educ_a == "10" ~ "professional school",
      educ_a == "11" ~ "doctoral degree",
      educ_a == "97" ~ "refused",
      educ_a == "98" ~ "not ascertained",
      educ_a == "99" ~ "don't know"
    ),
    
    race = case_when(
      hispallp_a == "1" ~ "hispanic",
      hispallp_a == "2" ~ "white",
      hispallp_a == "3" ~ "black or african american",
      hispallp_a == "4" ~ "asian",
      hispallp_a == "5" ~ "aian",
      hispallp_a == "6" ~ "aian and other",
      hispallp_a == "7" ~ "multiple races",
      hispallp_a == "97" ~ "refused",
      hispallp_a == "98" ~ "not ascertained",
      hispallp_a == "99" ~ "don't know"
    ),
    
    hispanic_origin = case_when(
      hisdetp_a == "1" ~ "mexican",
      hisdetp_a == "2" ~ "other hispanic",
      hisdetp_a == "3" ~ "not hispanic",
      hisdetp_a == "7" ~ "refused",
      hisdetp_a == "8" ~ "not ascertained",
      hisdetp_a == "9" ~ "don't know"
    ),
    
    disability = case_when(
      disab3_a == "1" ~ "yes",
      disab3_a == "2" ~ "no",
      disab3_a == "9" ~ "don't know"
    ),
    
    health = case_when(
      phstat_a == "1" ~ "excellent",
      phstat_a == "2" ~ "very good",
      phstat_a == "3" ~ "good",
      phstat_a == "4" ~ "fair",
      phstat_a == "5" ~ "poor",
      phstat_a == "7" ~ "refused",
      phstat_a == "8" ~ "not ascertained",
      phstat_a == "9" ~ "don't know"
    ),
    
    orient = case_when(
      orient_a == "1" ~ "gaylesbian",
      orient_a == "2" ~ "straight",
      orient_a == "3" ~ "bisexual",
      orient_a == "4" ~ "else",
      orient_a == "5" ~ "unknown",
      orient_a == "7" ~ "refused",
      orient_a == "8" ~ "not ascertained",
      orient_a == "9" ~ "don't know"
    ),
    
    bmi = case_when(
      bmicat_a == "1" ~ "underweight",
      bmicat_a == "2" ~ "healthy weight",
      bmicat_a == "3" ~ "overweight",
      bmicat_a == "4" ~ "obese",
      bmicat_a == "9" ~ "unknown"
    ),
    
    cancer = case_when(
      canev_a == "1" ~ "yes",
      canev_a == "2" ~ "no",
      canev_a == "7" ~ "refused",
      canev_a == "8" ~ "not ascertained",
      canev_a == "9" ~ "don't know"
    ),

    diabetes_type = case_when(
      dibtype_a == "1" ~ "type 1",
      dibtype_a == "2" ~ "type 2",
      dibtype_a == "3" ~ "other",
      dibtype_a == "7" ~ "refused",
      dibtype_a == "8" ~ "not ascertained",
      dibtype_a == "9" ~ "don't know"
    ),
    
    dementia = case_when(
      demenev_a == "1" ~ "yes",
      demenev_a == "2" ~ "no",
      demenev_a == "7" ~ "refused",
      demenev_a == "8" ~ "not ascertained",
      demenev_a == "9" ~ "don't know"
    ),
    
    heart_disease = case_when(
      chdev_a == "1" ~ "yes",
      chdev_a == "2" ~ "no",
      chdev_a == "7" ~ "refused",
      chdev_a == "8" ~ "not ascertained",
      chdev_a == "9" ~ "don't know"
    ),
    
    asthma = case_when(
      astill_a == "1" ~ "yes",
      astill_a == "2" ~ "no",
      astill_a == "7" ~ "refused",
      astill_a == "8" ~ "not ascertained",
      astill_a == "9" ~ "don't know"
    ),
    
    stroke = case_when(
      strev_a == "1" ~ "yes",
      strev_a == "2" ~ "no",
      strev_a == "7" ~ "refused",
      strev_a == "8" ~ "not ascertained",
      strev_a == "9" ~ "don't know"
    ),
    
    hypertention = case_when(
      hypev_a == "1" ~ "yes",
      hypev_a == "2" ~ "no",
      hypev_a == "7" ~ "refused",
      hypev_a == "8" ~ "not ascertained",
      hypev_a == "9" ~ "don't know"
    ),
    
    copd = case_when(
      copdev_a == "1" ~ "yes",
      copdev_a == "2" ~ "no",
      copdev_a == "7" ~ "refused",
      copdev_a == "8" ~ "not ascertained",
      copdev_a == "9" ~ "don't know"
    ),
    
    anxiety = case_when(
      anxev_a == "1" ~ "yes",
      anxev_a == "2" ~ "no",
      anxev_a == "7" ~ "refused",
      anxev_a == "8" ~ "not ascertained",
      anxev_a == "9" ~ "don't know"
    ),
    
    depression = case_when(
      depev_a == "1" ~ "yes",
      depev_a == "2" ~ "no",
      depev_a == "7" ~ "refused",
      depev_a == "8" ~ "not ascertained",
      depev_a == "9" ~ "don't know"
    ),
    
    pregnant = case_when(
      pregnow_a == "1" ~ "yes",
      pregnow_a == "2" ~ "no",
      pregnow_a == "7" ~ "refused",
      pregnow_a == "8" ~ "not ascertained",
      pregnow_a == "9" ~ "don't know"
    ),
    
    immune_weaken = case_when(
      hlthcond_a == "1" ~ "yes",
      hlthcond_a == "2" ~ "no",
      hlthcond_a == "7" ~ "refused",
      hlthcond_a == "8" ~ "not ascertained",
      hlthcond_a == "9" ~ "don't know"
    )
  )

adult = adult %>%
  select(-sex_a, -agep_a, -smkcigst_a, -phstat_a, -educ_a, -hispallp_a, -hisdetp_a, -orient_a, -bmicat_a, -canev_a, -dibev_a, -dibtype_a, -copdev_a, -hypev_a, -strev_a, -astill_a, -chdev_a, -demenev_a, -hlthcond_a, -pregnow_a, -depev_a, -anxev_a, -disab3_a) %>%
  relocate(year, smoke, sex, age, orient, education, race, hispanic_origin, disability, health, cancer, asthma, copd, dementia, diabetes_type, heart_disease, hypertention, anxiety, depression, bmi, pregnant, stroke, immune_weaken) %>%
  mutate(
    diabetes_type = replace(diabetes_type, is.na(diabetes_type), "missing"),
    asthma = replace(asthma, is.na(asthma), "missing"),
    pregnant = replace(pregnant, is.na(pregnant), "missing"),
    immune_weaken = replace(immune_weaken, is.na(immune_weaken), "missing")
  )

```

#Making Plot
```{r}
adult=
  adult%>%
  mutate(smoke = recode(smoke,"current every day smoker"="current smoker","current some day smoker"="current smoker"))%>%
  drop_na()
  
 
adult

sex_df=
  adult%>%
  group_by(smoke,sex,year)%>%
  summarise(n=n())%>%
  filter(sex%in%c("female","male"))%>%
  mutate(sex_year=str_c(sex,year))
sex_df

sex_df1=
  sex_df%>%
  group_by(sex_year)%>%
  summarise(sum=sum(n))

sex_df1
  
sex_df1
ggplot(sex_df,aes(fill=smoke,x=sex_year,group=sex))+
  geom_histogram(position="identity",stat="count")+
  labs(
    title="smokers by sex in 2019 and 2020",
    xlab="sex",
    ylab="value"
  )

education_df=
  adult%>%
  group_by(smoke,education,year)%>%
  summarise(n=n())%>%
  filter(education%in%c("never attended/kindergarten only","grade 1-11","12th grade, no diploma","GED or equivalent","high school graduate","some college, no degree","associate degree: occupational, technical, or vocational program","associate degree: academic program","bachelor's degree","master's degree","professional School degree","doctoral degree"))%>%
  mutate(education_year=str_c(education,year))
education_df
ggplot(education_df,aes(fill=smoke,x=education_year,y=n))+
  geom_bar(position="stack", stat="identity")+
  labs(
    title="smokers by education in 2019 and 2020",
    xlab="education",
    ylab="value"
  )+
  theme(axis.text.x=element_text(angle=45))
```



```{r adult_smoke}
adult_smoke = 
  adult %>%
  filter(smoke %in% c("current every day smoker", "current some day smoker", "former smoker", "never smoker")) %>%
  mutate(
    smoke = recode(smoke, "current every day smoker" = "current smoker", "current some day smoker" = "current smoker")
  ) %>%
  mutate(
    sex = as.factor(sex),
    smoke = as.factor(smoke),
    orient = as.factor(orient),
    education = as.factor(education),
    race = as.factor(race),
    hispanic_origin = as.factor(hispanic_origin),
    disability = as.factor(disability),
    health = as.factor(health), 
    cancer = as.factor(cancer), 
    asthma = as.factor(asthma), 
    copd = as.factor(copd), 
    dementia = as.factor(dementia), 
    diabetes_type = as.factor(dementia), 
    heart_disease = as.factor(heart_disease), 
    hypertention = as.factor(hypertention), 
    anxiety = as.factor(anxiety), 
    depression = as.factor(depression), 
    bmi = as.factor(bmi), 
    pregnant = as.factor(pregnant), 
    stroke = as.factor(stroke), 
    immune_weaken = as.factor(immune_weaken)
  ) %>%
  mutate(
    smoke = fct_relevel(smoke, "current smoker", "former smoker", "never smoker")
  )
```


```{r}
adult=
  adult%>%
  mutate(smoke = recode(smoke,"never smoker"="never smoker",
      "current every day smoker"="current smoker",
      "current some day smoker"="current smoker",
      "former smoker"="former smoker",
  ))%>%
  filter(smoke %in% c("current smoker","former smoker"))

adult

sex_df=
  adult%>%
  group_by(smoke,sex)%>%
  summarise(n=n())%>%
  filter(sex%in%c("female","male"))%>%
  group_by(sex)%>%
  mutate(sum=sum(n))%>%
  mutate(percentage=n/sum)


sex_df
ggplot(sex_df,aes(fill=smoke,x=sex,y=percentage))+
  geom_bar(position="stack", stat="identity")+
  labs(
    title="smokers by sex",
    x="sex",
    y="value"
  )+
  theme(text=element_text(size=18),axis.text.x=element_text(angle=45))


education_df=
  adult%>%
  group_by(smoke,education)%>%
  summarise(n=n())%>%
  filter(education%in%c("never attended/kindergarten only","grade 1-11","12th grade, no diploma","GED or equivalent","high school graduate","some college, no degree","associate degree:occupational...","associate degree: academic","bachelor's degree","doctoral degree"))%>%
  group_by(education)%>%
  mutate(sum=sum(n))%>%
  mutate(percentage=n/sum)
education_df


ggplot(education_df,aes(fill=smoke,x=education,y=percentage))+
  geom_bar(position="stack", stat="identity")+
  labs(
    title="smokers by education",
    x="education",
    y="value"
  )+
  theme(text=element_text(size=18),axis.text.x=element_text(angle=45))

age_df=
  adult%>%
  mutate(age1=ifelse(age<=18,"0-18 years old",ifelse(age<=21,"18-21 years old",ifelse(age<=65,"21-65 years old","above 65 years old"))))%>%
  group_by(smoke,age1)%>%
  summarise(n=n())%>%
  group_by(age1)%>%
  mutate(sum=sum(n))%>%
  mutate(percentage=n/sum)
age_df

ggplot(age_df,aes(fill=smoke,x=age1,y=percentage))+
  geom_bar(position="stack", stat="identity")+
  labs(
    title="smokers by age",
    x="age",
    y="value"
  )+
  theme(text=element_text(size=18),axis.text.x=element_text(angle=45))

health_status_df=
  adult%>%
  filter(health%in%c("excellent","vert good","good","fair","poor"))%>%
  group_by(smoke,health)%>%
  summarise(n=n())%>%
  group_by(health)%>%
  mutate(sum=sum(n))%>%
  mutate(percentage=n/sum)

ggplot(health_status_df,aes(fill=smoke,x=health,y=percentage))+
  geom_bar(position="stack", stat="identity")+
  labs(
    title="smokers by health",
    x="health",
    y="value"
  )+
  theme(text=element_text(size=18),axis.text.x=element_text(angle=45))

race_df=
  adult%>%
  group_by(smoke,race)%>%
  summarise(n=n())%>%
  group_by(race)%>%
  mutate(sum=sum(n))%>%
  mutate(percentage=n/sum)

ggplot(race_df,aes(fill=smoke,x=race,y=percentage))+
  geom_bar(position="stack", stat="identity")+
  labs(
    title="smokers by race",
    x="race",
    y="value"
  )+
  theme(text=element_text(size=18),axis.text.x=element_text(angle=45))

disability_df=
  adult%>%
  filter(disability!="don't know")%>%
  group_by(smoke,disability)%>%
  summarise(n=n())%>%
  group_by(disability)%>%
  mutate(sum=sum(n))%>%
  mutate(percentage=n/sum)
  
ggplot(disability_df,aes(fill=smoke,x=disability,y=percentage))+
  geom_bar(position="stack", stat="identity")+
  labs(
    title="smokers by disability",
    x="disability",
    y="value"
  )+
  theme(text=element_text(size=18),axis.text.x=element_text(angle=45))
  
orient_df=
  adult%>%
  filter(!orient%in%c("not ascertained","refused","unknown"))%>%
  group_by(smoke,orient)%>%
  summarise(n=n())%>%
  group_by(orient)%>%
  mutate(sum=sum(n))%>%
  mutate(percentage=n/sum)
  
ggplot(orient_df,aes(fill=smoke,x=orient,y=percentage))+
  geom_bar(position="stack", stat="identity")+
  labs(
    title="smokers by orient",
    x="orient",
    y="value"
  )+
  theme(text=element_text(size=18),axis.text.x=element_text(angle=45))  

immune_weaken_df=
  adult%>%
  filter(!immune_weaken%in%c("not ascertained","refused","don't know","missing"))%>%
  group_by(smoke,immune_weaken)%>%
  summarise(n=n())%>%
  group_by(immune_weaken)%>%
  mutate(sum=sum(n))%>%
  mutate(percentage=n/sum)
  
ggplot(immune_weaken_df,aes(fill=smoke,x=immune_weaken,y=percentage))+
  geom_bar(position="stack", stat="identity")+
  labs(
    title="smokers by immune weaken",
    x="immune weaken",
    y="value"
  )+
  theme(text=element_text(size=18),axis.text.x=element_text(angle=45))
```
From the graph above, we can see that male smoke less than female. Also, from the above age chart, people who are younger 


```{r}
#Cancer
cancer_df=
  adult%>%
  group_by(year,smoke,cancer)%>%
  filter(!cancer%in%c("don't know","refused","no"))%>%
  summarise(n=n())%>%
  mutate(cancer_year=str_c(cancer,year))%>%
  group_by(cancer_year)%>%
  mutate(sum=sum(n))%>%
  mutate(percentage=n/sum)
cancer_df
  
ggplot(cancer_df,aes(fill=smoke,x=cancer_year,y=percentage))+
  geom_bar(position="stack", stat="identity")+
  labs(
    title="smokers by cancer in 2019 and 2020",
    x="cancer",
    y="value"
  )+
  theme(text=element_text(size=18),axis.text.x=element_text(angle=45))


#Diabetes type
diabetes_df=
  adult%>%
  mutate(diabetes_type=recode(diabetes_type,"type 1"="diabetes","type 2"="diabetes"))%>%
  group_by(year,smoke,diabetes_type)%>%
  filter(!diabetes_type%in%c("don't know","refused","missing","other"))%>%
  summarise(n=n())%>%
  mutate(diabetes_year=str_c(diabetes_type,year))%>%
  group_by(diabetes_year)%>%
  mutate(sum=sum(n))%>%
  mutate(percentage=n/sum)
diabetes_df
  
ggplot(diabetes_df,aes(fill=smoke,x=diabetes_year,y=percentage))+
  geom_bar(position="stack", stat="identity")+
  labs(
    title="smokers by diabetes in 2019 and 2020",
    x="diabetes",
    y="value"
  )+
  theme(text=element_text(size=18),axis.text.x=element_text(angle=45))




```
People who have cancer smoke less in the year of 2020 compare to the year of 2019. People who have diabetes smoke less in the year of 2020 compare to the year of 2019.

```{r}
#COP
cop_df=
  adult%>%
  group_by(year,smoke,copd)%>%
  filter(!copd%in%c("don't know","refused","missing","no"))%>%
  summarise(n=n())%>%
  mutate(copd_year=str_c(copd,year))%>%
  group_by(copd_year)%>%
  mutate(sum=sum(n))%>%
  mutate(percentage=n/sum)
cop_df
  
ggplot(cop_df,aes(fill=smoke,x=copd_year,y=percentage))+
  geom_bar(position="stack", stat="identity")+
  labs(
    title="smokers by COPD in 2019 and 2020",
    x="COPD",
    y="value"
  )+
  theme(text=element_text(size=18),axis.text.x=element_text(angle=45))


hypev_df=
  adult%>%
  group_by(year,smoke,hypertention)%>%
  filter(!hypertention%in%c("don't know","refused","missing","no"))%>%
  summarise(n=n())%>%
  mutate(hypertention_year=str_c(hypertention,year))%>%
  group_by(hypertention_year)%>%
  mutate(sum=sum(n))%>%
  mutate(percentage=n/sum)
hypev_df
  
ggplot(hypev_df,aes(fill=smoke,x=hypertention_year,y=percentage))+
  geom_bar(position="stack", stat="identity")+
  labs(
    title="smokers by hypertention in 2019 and 2020",
    x="hypertention",
    y="value"
  )+
  theme(text=element_text(size=18),axis.text.x=element_text(angle=45))
```
People who have COPD smoke less in the year of 2020 compare to the year of 2019. People who have hypertention smoke less in the year of 2020 compare to the year of 2019.

```{r}
#Stroke
stroke_df=
  adult%>%
  group_by(year,smoke,stroke)%>%
  filter(!stroke%in%c("don't know","refused","missing","no"))%>%
  summarise(n=n())%>%
  mutate(stroke_year=str_c(stroke,year))%>%
  group_by(stroke_year)%>%
  mutate(sum=sum(n))%>%
  mutate(percentage=n/sum)
stroke_df
  
ggplot(stroke_df,aes(fill=smoke,x=stroke_year,y=percentage))+
  geom_bar(position="stack", stat="identity")+
  labs(
    title="smokers by stroke in 2019 and 2020",
    x="stroke",
    y="value"
  )+
  theme(text=element_text(size=18),axis.text.x=element_text(angle=45))

#Asthma
asthma_df=
  adult%>%
  group_by(year,smoke,asthma)%>%
  filter(!asthma%in%c("don't know","refused","missing","no"))%>%
  summarise(n=n())%>%
  mutate(asthma_year=str_c(asthma,year))%>%
  group_by(asthma_year)%>%
  mutate(sum=sum(n))%>%
  mutate(percentage=n/sum)
asthma_df
  
ggplot(asthma_df,aes(fill=smoke,x=asthma_year,y=percentage))+
  geom_bar(position="stack", stat="identity")+
  labs(
    title="smokers by asthma in 2019 and 2020",
    x="asthma",
    y="value"
  )+
  theme(text=element_text(size=18),axis.text.x=element_text(angle=45))

#Dementia
dementia_df=
  adult%>%
  group_by(year,smoke,dementia)%>%
  filter(!dementia%in%c("don't know","refused","missing","no"))%>%
  summarise(n=n())%>%
  mutate(dementia_year=str_c(dementia,year))%>%
  group_by(dementia_year)%>%
  mutate(sum=sum(n))%>%
  mutate(percentage=n/sum)
dementia_df
  
ggplot(dementia_df,aes(fill=smoke,x=dementia_year,y=percentage))+
  geom_bar(position="stack", stat="identity")+
  labs(
    title="smokers by dementia in 2019 and 2020",
    x="dementia",
    y="value"
  )+
  theme(text=element_text(size=18),axis.text.x=element_text(angle=45))

# Heart Disease
heart_disease_df=
  adult%>%
  group_by(year,smoke,heart_disease)%>%
  filter(!heart_disease%in%c("don't know","refused","missing","no"))%>%
  summarise(n=n())%>%
  mutate(heart_disease_year=str_c(heart_disease,year))%>%
  group_by(heart_disease_year)%>%
  mutate(sum=sum(n))%>%
  mutate(percentage=n/sum)
heart_disease_df
  
ggplot(heart_disease_df,aes(fill=smoke,x=heart_disease_year,y=percentage))+
  geom_bar(position="stack", stat="identity")+
  labs(
    title="smokers by heart disease in 2019 and 2020",
    x="heart disease",
    y="value"
  )+
  theme(text=element_text(size=18),axis.text.x=element_text(angle=45))

  
```
People who have asthma and heart disease smoke less in the year of 2020 compare to the year of 2019.

```{r}
#Anxiety
anxiety_df=
  adult%>%
  group_by(year,smoke,anxiety)%>%
  filter(!anxiety%in%c("don't know","refused","missing","no"))%>%
  summarise(n=n())%>%
  mutate(anxiety_year=str_c(anxiety,year))%>%
  group_by(anxiety_year)%>%
  mutate(sum=sum(n))%>%
  mutate(percentage=n/sum)
anxiety_df
  
ggplot(anxiety_df,aes(fill=smoke,x=anxiety_year,y=percentage))+
  geom_bar(position="stack", stat="identity")+
  labs(
    title="smokers by anxiety in 2019 and 2020",
    x="anxiety",
    y="value"
  )+
  theme(text=element_text(size=18),axis.text.x=element_text(angle=45))

#Depression
depression_df=
  adult%>%
  group_by(year,smoke,depression)%>%
  filter(!depression%in%c("don't know","refused","missing","no"))%>%
  summarise(n=n())%>%
  mutate(depression_year=str_c(depression,year))%>%
  group_by(depression_year)%>%
  mutate(sum=sum(n))%>%
  mutate(percentage=n/sum)
depression_df
  
ggplot(depression_df,aes(fill=smoke,x=depression_year,y=percentage))+
  geom_bar(position="stack", stat="identity")+
  labs(
    title="smokers by depression in 2019 and 2020",
    x="depression",
    y="value"
  )+
  theme(text=element_text(size=18),axis.text.x=element_text(angle=45))
  
```
People who have anxiety and depression smoke less in the year of 2020.

```{r}
#Bmi
bmi_df=
  adult%>%
  group_by(year,smoke,bmi)%>%
  filter(!bmi%in%c("don't know","refused","missing","unknown","no"))%>%
  summarise(n=n())%>%
  mutate(bmi_year=str_c(bmi,year))%>%
  group_by(bmi_year)%>%
  mutate(sum=sum(n))%>%
  mutate(percentage=n/sum)
bmi_df
  
ggplot(bmi_df,aes(fill=smoke,x=bmi_year,y=percentage))+
  geom_bar(position="stack", stat="identity")+
  labs(
    title="smokers by bmi in 2019 and 2020",
    x="bmi",
    y="value"
  )+
  theme(text=element_text(size=18),axis.text.x=element_text(angle=45))

#Pregnant
pregnant_df=
  adult%>%
  group_by(year,smoke,pregnant)%>%
  filter(!pregnant%in%c("don't know","refused","missing","unknown","no","not ascertained"))%>%
  summarise(n=n())%>%
  mutate(pregnant_year=str_c(pregnant,year))%>%
  group_by(pregnant_year)%>%
  mutate(sum=sum(n))%>%
  mutate(percentage=n/sum)
pregnant_df
  
ggplot(pregnant_df,aes(fill=smoke,x=pregnant_year,y=percentage))+
  geom_bar(position="stack", stat="identity")+
  labs(
    title="smokers by pregnant in 2019 and 2020",
    x="pregnant",
    y="value"
  )+
  theme(text=element_text(size=18),axis.text.x=element_text(angle=45))
```
From the above chart, we can see that whether people have healthy weight, obese, overweight all smoke less in the year of 2020 compare to the year of 2019. People who is underweight smoke a little bit more in the year of 2020.



